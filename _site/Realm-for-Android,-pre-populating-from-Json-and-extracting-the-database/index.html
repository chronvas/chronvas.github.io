<!DOCTYPE html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]--><!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8"><![endif]--><!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9"><![endif]--><!--[if gt IE 8]><!--><html class="no-js">
<!--<![endif]--> <head> <meta charset="UTF-8"> <meta content="text/html; charset=UTF-8" http-equiv="Content-Type"> <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"> <title>Realm for Android, pre-populating from Json and extracting the database – </title> <meta name="description" content="Moon is a minimal, one column jekyll theme for your blog."> <meta name="keywords" content="sample post, code, highlighting"> <!-- Twitter Cards --> <meta name="twitter:card" content="summary"> <meta name="twitter:image" content="http://chronvas.github.io/assets/img/logo.png"> <meta name="twitter:title" content="Realm for Android, pre-populating from Json and extracting the database"> <meta name="twitter:description" content="Playing with Realm and Android."> <!-- Open Graph --> <meta property="og:locale" content="en_US"> <meta property="og:type" content="article"> <meta property="og:title" content="Realm for Android, pre-populating from Json and extracting the database"> <meta property="og:description" content="Playing with Realm and Android."> <meta property="og:url" content="http://chronvas.github.io/Realm-for-Android,-pre-populating-from-Json-and-extracting-the-database/"> <meta property="og:site_name" content=""> <meta property="og:image" content="http://chronvas.github.io/assets/img/logo.png"> <link rel="canonical" href="http://chronvas.github.io/Realm-for-Android,-pre-populating-from-Json-and-extracting-the-database/"> <link href="http://chronvas.github.io/feed.xml" type="application/atom+xml" rel="alternate" title=" Feed"> <!-- Handheld --> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- CSS --> <link rel="stylesheet" href="http://chronvas.github.io/assets/css/main.css"> <!-- JS --> <script src="http://chronvas.github.io/assets/js/modernizr-3.3.1.custom.min.js"></script> <!-- Favicons --> <link rel="apple-touch-icon" href="http://chronvas.github.io/assets/img/favicons/apple-icon-precomposed.png"> <link rel="apple-touch-icon" sizes="72x72" href="http://chronvas.github.io/assets/img/favicons/apple-icon-72x72.png"> <link rel="apple-touch-icon" sizes="114x114" href="http://chronvas.github.io/assets/img/favicons/apple-icon-114x114.png"> <link rel="apple-touch-icon" sizes="144x144" href="http://chronvas.github.io/assets/img/favicons/apple-icon-144x144.png"> <link rel="shortcut icon" type="image/png" href="http://chronvas.github.io/favicon.png"> <link rel="shortcut icon" href="http://chronvas.github.io/favicon.ico"> <!-- Background Image --> <style type="text/css">body {background-image:url(http://chronvas.github.io/assets/img/placeholder-big.jpg);}</style> <!-- Post Feature Image --> </head> <body> <nav id="dl-menu" class="dl-menuwrapper" role="navigation"> <button class="dl-trigger">Open Menu</button> <ul class="dl-menu"> <li><a href="http://chronvas.github.io/">Home</a></li> <li> <a href="#">About</a> <ul class="dl-submenu"> <li> <img src="http://chronvas.github.io/assets/img/logo.png" alt=" photo" class="author-photo"> <h4></h4> <p>Moon is a minimal, one column jekyll theme for your blog.</p> </li> <li><a href="http://chronvas.github.io/about/"><span class="btn btn-inverse">Learn More</span></a></li> <li> <a href="http://linkedin.com/in/chronvas" target="_blank"><i class="fa fa-fw fa-linkedin-square"></i> LinkedIn</a> </li> <li> <a href="http://github.com/chronvas" target="_blank"><i class="fa fa-fw fa-github"></i> Github</a> </li> <li> <a href="http://stackoverflow.com/users/5932049/ch-vas" target="_blank"><i class="fa fa-fw fa-stack-overflow"></i> StackOverflow</a> </li> </ul>
<!-- /.dl-submenu --> </li> <li> <a href="#">Posts</a> <ul class="dl-submenu"> <li><a href="http://chronvas.github.io/posts/">All Posts</a></li> <li><a href="http://chronvas.github.io/tags/">All Tags</a></li> </ul> </li> <li><a href="http://chronvas.github.io/projects/">Projects</a></li> </ul>
<!-- /.dl-menu --> </nav><!-- /.dl-menuwrapper --> <!-- Header --> <header class="header" role="banner"> <div class="wrapper animated fadeIn"> <div class="content"> <div class="post-title "> <h1>Realm for Android, pre-populating from Json and extracting the database</h1> <h4>01 Aug 2016</h4> <p class="reading-time"> <i class="fa fa-clock-o"></i> Reading time ~2 minutes </p>
<!-- /.entry-reading-time --> <a class="btn zoombtn" href="http://chronvas.github.io/posts/"> <i class="fa fa-chevron-left"></i> </a> </div> <p>Scroll to read, or continue reding in <a class="social-btn" href="https://medium.com/index" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-medium"></i></a></p> <p>I’ve came across the “hustle” of creating an app that will use Realm, having the database previously populated with data and just include the created database file in the published app, omitting the Json (or any other file) that is being used to populate it.</p> <p>Doing so for a “to be published” app saves time (parsing the file and populating a db) and space (omitting the file which used to create the database).</p> <h3 id="the-main-idea">The main idea:</h3> <figure> <a href="https://github.com/chronvas/chronvas.github.io/raw/master/assets/img/realm1.png"><img src="https://github.com/chronvas/chronvas.github.io/raw/master/assets/img/realm1.png"></a> </figure> <p>I’m going to show the simplest possible way to achieve this, but this can be much improved (a separate Gradle task maybe?) and even be a part of the main project, not having to maintain 2 code bases and 2 different projects for one app.</p> <h3 id="for-the-hasty">For the hasty</h3> <p>The project is on <a href="https://github.com/chronvas/RealmTesting">Github</a>, but check the “Keep in mind” section first</p> <h3 id="begin">Begin!</h3> <p>I am using the latest Android Studio (2.2) and Realm Java version 2.0.0 . The build.gradle of the project looks like this:</p> <noscript><pre>// Top-level build file where you can add configuration options common to all sub-projects/modules.

buildscript {
    repositories {
        jcenter()
    }
    dependencies {
        classpath 'com.android.tools.build:gradle:2.2.0'
        classpath "io.realm:realm-gradle-plugin:2.0.0"
        // NOTE: Do not place your application dependencies here; they belong
        // in the individual module build.gradle files
    }

}

allprojects {
    repositories {
        jcenter()
    }
}

task clean(type: Delete) {
    delete rootProject.buildDir
}
</pre></noscript> <script src="https://gist.github.com/chronvas/cea8c32673394fde6d086e6a5f2a2987.js"> </script> <p>And the build.gradle of the app module looks like this:</p> <noscript><pre>apply plugin: 'com.android.application'
apply plugin: 'realm-android'

android {
    compileSdkVersion 24
    buildToolsVersion "24.0.3"
    defaultConfig {
        applicationId "com.example.chronvas.realmtesting"
        minSdkVersion 15
        targetSdkVersion 24
        versionCode 1
        versionName "1.0"
        testInstrumentationRunner "android.support.test.runner.AndroidJUnitRunner"
    }
    buildTypes {
        release {
            minifyEnabled false
            proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro'
        }
    }
}

dependencies {
    compile fileTree(dir: 'libs', include: ['*.jar'])
    androidTestCompile('com.android.support.test.espresso:espresso-core:2.2.2', {
        exclude group: 'com.android.support', module: 'support-annotations'
    })
    compile 'com.android.support:appcompat-v7:24.2.1'
    compile 'com.android.support:design:24.2.1'
    testCompile 'junit:junit:4.12'
}
</pre></noscript> <script src="https://gist.github.com/chronvas/78f531b54a718d0441a65df5a4d8d275.js"> </script> <p>It’s time to add a class that extends android.app.Application, so our whole application starts from this class and Realm gets initialized and configured on OnCreate. It’s handy to set a name for your .realm file containing the database. More configurations can be <a href="https://realm.io/docs/java/latest/api/io/realm/RealmConfiguration.Builder.html">passed</a> in this way. Just remember to point out this class in the Android Manifest.</p> <noscript><pre>package com.example.chronvas.realmtesting.app;

import android.app.Application;

import io.realm.Realm;
import io.realm.RealmConfiguration;

public class App extends Application {

    @Override
    public void onCreate() {
        super.onCreate();

        //Config Realm for the application
        Realm.init(this);
        RealmConfiguration realmConfiguration = new RealmConfiguration.Builder()
                .name("testdb.realm")
                .build();

        Realm.setDefaultConfiguration(realmConfiguration);
    }

}
</pre></noscript> <script src="https://gist.github.com/chronvas/bd721b11d31cda98b61c04a6f3861d88.js"> </script> <h3 id="github-gist-embed">GitHub Gist Embed</h3> <p>An example of a Gist embed below.</p> <noscript><pre>package com.example.chronvas.realmtesting.app;

import android.app.Application;

import com.example.chronvas.realmtesting.R;

import java.io.File;
import java.io.FileOutputStream;
import java.io.IOException;
import java.io.InputStream;

import io.realm.Realm;
import io.realm.RealmConfiguration;

public class App extends Application {

    @Override
    public void onCreate() {
        super.onCreate();

        copyBundledRealmFile(this.getResources().openRawResource(R.raw.testdb), "testdb.realm");

        //Config Realm for the application
        RealmConfiguration realmConfiguration = new RealmConfiguration.Builder(this)
                .name("testdb.realm")
                .build();

        Realm.setDefaultConfiguration(realmConfiguration);
    }

    private String copyBundledRealmFile(InputStream inputStream, String outFileName) {
        File filesDir = this.getFilesDir();
        boolean found = findFile(outFileName, filesDir);
        if (!found) {
            try {
                File file = new File(this.getFilesDir(), outFileName);
                FileOutputStream outputStream = new FileOutputStream(file);
                byte[] buf = new byte[1024];
                int bytesRead;
                while ((bytesRead = inputStream.read(buf)) &gt; 0) {
                    outputStream.write(buf, 0, bytesRead);
                }
                outputStream.close();
                return file.getAbsolutePath();
            } catch (IOException e) {
                e.printStackTrace();
            }
        }
        return null;
    }

    public boolean findFile(String name, File file) {
        File[] list = file.listFiles();
        if (list != null)
            for (File fil : list) {
                if (fil.isDirectory()) {
                    findFile(name, fil);
                } else if (name.equalsIgnoreCase(fil.getName())) {
                    return true;
                }
            }
        return false;
    }
}
</pre></noscript> <script src="https://gist.github.com/chronvas/0e39355e36389e3992cbacc21bbe2596.js"> </script> <div class="entry-meta"> <br> <hr> <span class="entry-tags"><a href="http://chronvas.github.io/tags/#sample%20post" title="Pages tagged sample post" class="tag"><span class="term">sample post</span></a><a href="http://chronvas.github.io/tags/#code" title="Pages tagged code" class="tag"><span class="term">code</span></a><a href="http://chronvas.github.io/tags/#highlighting" title="Pages tagged highlighting" class="tag"><span class="term">highlighting</span></a></span> <span class="social-share"> <a href="https://www.facebook.com/sharer/sharer.php?u=http://chronvas.github.io/Realm-for-Android,-pre-populating-from-Json-and-extracting-the-database/" title="Share on Facebook" class="tag"> <span class="term"><i class="fa fa-facebook-square"></i> Like</span> </a> <a href="https://twitter.com/intent/tweet?text=http://chronvas.github.io/Realm-for-Android,-pre-populating-from-Json-and-extracting-the-database/" title="Share on Twitter" class="tag"> <span class="term"><i class="fa fa-twitter-square"></i> Tweet</span> </a> <a href="https://plus.google.com/share?url=http://chronvas.github.io/Realm-for-Android,-pre-populating-from-Json-and-extracting-the-database/" title="Share on Google+" class="tag"> <span class="term"><i class="fa fa-google-plus-square"></i> +1</span> </a> </span> <div style="clear:both"></div> </div> </div> </div> </header> <!-- JS --> <script src="http://chronvas.github.io/assets/js/jquery-1.12.0.min.js"></script> <script src="http://chronvas.github.io/assets/js/jquery.dlmenu.min.js"></script> <script src="http://chronvas.github.io/assets/js/jquery.goup.min.js"></script> <script src="http://chronvas.github.io/assets/js/jquery.magnific-popup.min.js"></script> <script src="http://chronvas.github.io/assets/js/jquery.fitvid.min.js"></script> <script src="http://chronvas.github.io/assets/js/scripts.js"></script> <!-- MathJax --> <script async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script> </body> </html>
